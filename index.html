<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <h1>Добро пожаловать!</h1>
    <p>Нажмите одну из кнопок ниже для взаимодействия с Telegram API.</p>

    <button id="selectChannel">Открыть окно выбора канала</button>
    <button id="openLink">Открыть ссылку Telegram</button>

    <script>
        const tg = window.Telegram.WebApp;

        tg.expand(); // Расширяет приложение на весь экран

        // Первая кнопка: выбор канала
        document.getElementById("selectChannel").addEventListener("click", function () {
            const botUsername = "GiveMePublicBot"; // Замените на имя вашего бота
            const permissions = [
                "post_messages",
                "edit_messages",
                "delete_messages",
                "restrict_members",
                "promote_members",
                "pin_messages",
                "manage_chat"
            ].join("+");

            const url = `https://t.me/${botUsername}?startchannel&admin=${permissions}`;
            tg.openTelegramLink(url); // Открываем ссылку через Telegram
        });

        // Вторая кнопка: кастомная функция
        document.getElementById("openLink").addEventListener("click", function () {
            const url = "https://t.me/GiveMePublicBot?start=test"; // Замените ссылку на вашу
            openTelegramLink(url, { force_request: true });
        });

        // Кастомная функция WebApp.openTelegramLink
        function openTelegramLink(url, options) {
            var a = document.createElement('A');
            a.href = url;

            // Проверка протокола
            if (a.protocol != 'http:' && a.protocol != 'https:') {
                console.error('[Telegram.WebApp] Url protocol is not supported', url);
                throw Error('WebAppTgUrlInvalid');
            }

            // Проверка хоста
            if (a.hostname != 't.me') {
                console.error('[Telegram.WebApp] Url host is not supported', url);
                throw Error('WebAppTgUrlInvalid');
            }

            var path_full = a.pathname + a.search;
            options = options || {};

            if (tg.isIframe || tg.versionAtLeast('6.1')) {
                var req_params = { path_full: path_full };
                if (options.force_request) {
                    req_params.force_request = true;
                }
                tg.postEvent('web_app_open_tg_link', false, req_params);
            } else {
                location.href = 'https://t.me' + path_full;
            }
        }
    </script>
</body>
</html>
